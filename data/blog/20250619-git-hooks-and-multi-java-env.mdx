---
title: 'Git Hooksä¸å¤šJDKç¯å¢ƒé—®é¢˜è§£å†³'
date: '2025-06-19 22:00:00'
tags: ['Git', 'å¼€å‘ä¹ æƒ¯', 'è§£å†³æ–¹æ¡ˆ']
summary: 'å…¬å¸é€šè¿‡ git commit hook å®ç°ä»£ç æäº¤å‰æ ¡éªŒï¼Œä½†æœ¬åœ°å¤šJDKç¯å¢ƒï¼ˆæœ€é«˜JDK22ï¼‰å¯¼è‡´ Maven spotless æ’ä»¶æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚'
draft: false
---

# Git Hooksä¸å¤šJDKç¯å¢ƒé—®é¢˜è§£å†³

## ğŸ§  èµ·å› 

å…¬å¸ä½¿ç”¨äº† git commit hook åœ¨ git æäº¤ä¹‹å‰å¯¹æäº¤çš„å†…å®¹ä¸ä»£ç è¿›è¡Œå‰ç½®æ ¡éªŒã€‚
æˆ‘æœ¬åœ°å­˜åœ¨å¤šä¸ª JDK ç‰ˆæœ¬ï¼Œæœ€é«˜ç‰ˆæœ¬ä¸º JDK22ï¼Œå› æ­¤åœ¨ä½¿ç”¨ mvn çš„ spotless æ’ä»¶æ—¶ä¼šå‡ºç°æ— æ³•æ‰§è¡Œçš„é—®é¢˜ã€‚

<ErrorDisplay
  title="Maven Spotless æ’ä»¶æ‰§è¡Œå¤±è´¥"
  error="java.lang.reflect.InvocationTargetException: 'com.sun.tools.javac.tree.JCTree com.sun.tools.javac.tree.JCTree$JCImport.getQualifiedIdentifier()'"
  code="1"
  path="Maven spotless plugin execution"
  details={[
    'JDK ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´çš„é—®é¢˜',
    'Spotless æ’ä»¶ä¸é«˜ç‰ˆæœ¬ JDK å­˜åœ¨å…¼å®¹æ€§é—®é¢˜',
    'Git hooks æ‰§è¡Œå¤±è´¥ï¼Œé˜»æ­¢ä»£ç æäº¤',
  ]}
/>

é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼š

```bash
[ERROR] Failed to execute goal com.diffplug.spotless:spotless-maven-plugin:2.30.0:apply(default-cli) on project qnvip-referral-client: Execution default-cli of goal com.diffplug.spotless:spotless-maven-plugin:2.30.0:apply failed: java.lang.reflect.InvocationTargetException: 'com.sun.tools.javac.tree.JCTree com.sun.tools.javac.tree.JCTree$JCImport.getQualifiedIdentifier()' -> [Help 1]
[ERROR]
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR]
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <args> -rf :qnvip-referral-client
husky - pre-commit script failed (code 1)
```

## ğŸ’¼ è§£å†³æ–¹æ¡ˆ

<Callout emoji="ğŸ’¡">
  è€ƒè™‘åˆ°æˆ–è®¸æœ‰äººä¼šå’Œæˆ‘ä¸€æ ·å®‰è£…å¤šä¸ª JDKï¼Œå› æ­¤ç»“åˆè¿™ä¸ªæƒ…å†µä¸æ‰¾åˆ°çš„èµ„æ–™ï¼Œæ¨èä½¿ç”¨ SDKMAN æ¥ç®¡ç† Java
  ç‰ˆæœ¬ã€‚
</Callout>

## âš™ï¸ å®‰è£… SDKMAN

å‚è€ƒ [SDKMAN å®‰è£…ä¸é…ç½®æŒ‡å—](/blog/install-sdkman) æ–‡æ¡£ï¼Œå…¶ä¸­å¯¹ Mac ç³»ç»Ÿç¯å¢ƒä¸ Windows ç³»ç»Ÿç¯å¢ƒçš„å®‰è£…éƒ½æœ‰è¯¦ç»†æŒ‡å¯¼ã€‚

<Callout emoji="ğŸ“–">å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… SDKMANï¼Œè¯·å…ˆé˜…è¯»å®‰è£…æŒ‡å—ï¼Œç„¶åå†ç»§ç»­æœ¬æ–‡çš„é…ç½®æ­¥éª¤ã€‚</Callout>

## âš™ï¸ å®‰è£…éœ€è¦çš„ JDK

### æŸ¥çœ‹å¯ç”¨çš„ Java ç‰ˆæœ¬

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç°åœ¨èƒ½ä½¿ç”¨çš„ Java ç‰ˆæœ¬ï¼š

```bash
sdk list java
```

### å®‰è£…é¡¹ç›®æ‰€éœ€çš„ JDK

è¿™ä¸ªç¯å¢ƒç›®å‰ä½¿ç”¨çš„æ˜¯ JDK8ã€‚æ‰¾åˆ°éœ€è¦çš„ç‰ˆæœ¬åæ‰§è¡Œï¼š

```bash
sdk install java 8.0.452-amzn
```

### éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼ŒéªŒè¯ Java ç‰ˆæœ¬ï¼š

```bash
java -version
```

é¢„æœŸè¾“å‡ºï¼š

```bash
openjdk version "1.8.0_452"
OpenJDK Runtime Environment (build 1.8.0_452-b08)
OpenJDK 64-Bit Server VM (build 25.452-b08, mixed mode)
```

## ğŸ”§ åœ¨é¡¹ç›®ä¸­é…ç½® SDKMAN

### é¡¹ç›®ç›®å½•ç»“æ„

å‡è®¾é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```plaintext
your-project/
â”œâ”€â”€ .husky/
â”‚   â””â”€â”€ pre-commit
â”œâ”€â”€ .sdkmanrc # sdkmané…ç½®
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â”œâ”€â”€ package.json
â”œâ”€â”€ lint-staged.config.js
â””â”€â”€ ...
```

### åˆ›å»º .sdkmanrc é…ç½®æ–‡ä»¶

éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹é…ç½® `.sdkmanrc` æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å†™å…¥ JDK ä¿¡æ¯ï¼š

```plaintext
# This file is used by SDKMAN to automatically switch to the correct Java version
# when entering this project directory
#
# æ³¨æ„ï¼š
# 1. æ­¤æ–‡ä»¶éœ€è¦ SDKMAN æ”¯æŒæ‰èƒ½ç”Ÿæ•ˆ
# 2. å¦‚æœæ‚¨æ²¡æœ‰å®‰è£… SDKMANï¼Œè¯·å‚è€ƒ [SDKMAN å®‰è£…ä¸é…ç½®æŒ‡å—](/blog/install-sdkman)
# 3. Windows ç”¨æˆ·éœ€è¦åœ¨ Git Bash æˆ–ç±»ä¼¼çš„ Unix-like ç¯å¢ƒä¸­ä½¿ç”¨ SDKMAN
# 4. å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ IDEï¼ˆå¦‚ IntelliJ IDEAï¼‰ï¼Œè¯·ç¡®ä¿åœ¨é¡¹ç›®è®¾ç½®ä¸­ä¹Ÿé…ç½®äº†æ­£ç¡®çš„ JDK
#
# Note:
# 1. This file requires SDKMAN to take effect
# 2. If you haven't installed SDKMAN, please refer to the installation guide
# 3. Windows users need to use SDKMAN in Git Bash or similar Unix-like environment
# 4. If you're using an IDE (like IntelliJ IDEA), make sure to configure the correct JDK in project settings

java=8.0.452-amzn
```

## ğŸ”§ é…ç½® pre-commit Hook

### å®Œæ•´çš„ pre-commit è„šæœ¬

è¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ pre-commit é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒè·¨å¹³å°ä½¿ç”¨ï¼š

```bash
#!/bin/sh
# Check if running on Windows or Unix-like system
case "$(uname -s)" in
  MINGW*|MSYS*|CYGWIN*)
    # Windows environment
    IS_WINDOWS=true
    SDKMAN_DIR="$USERPROFILE/.sdkman"
    SDKMAN_INIT="$SDKMAN_DIR/bin/sdkman-init.sh"
    ;;
  *)
    # Unix-like environment (macOS, Linux, etc.)
    IS_WINDOWS=false
    SDKMAN_DIR="$HOME/.sdkman"
    SDKMAN_INIT="$SDKMAN_DIR/bin/sdkman-init.sh"
    ;;
esac

# Check if .sdkmanrc file exists and SDKMAN is installed
if [ -f .sdkmanrc ] && [ -f "$SDKMAN_INIT" ]; then
  echo "SDKMAN detected, activating project Java version"
  # Load sdkman
  source "$SDKMAN_INIT"

  # Execute sdkman commands
  sdk env
else
  echo "SDKMAN not detected or .sdkmanrc not found. Using system Java version."
  # Print current Java version for reference
  if command -v java >/dev/null 2>&1; then
    echo "Current Java version: $(java -version 2>&1 | head -n 1)"
  else
    echo "Warning: Java not found in PATH"
  fi
fi

# Execute other pre-commit hooks
if [ -f "$HOME"/qnvip.gitconfig.sh ]; then
  bash "$HOME"/qnvip.gitconfig.sh
fi

npx --no-install node .husky/scripts/modify-author-from-file.js
npx lint-staged --verbose --debug
```

### è„šæœ¬åŠŸèƒ½è¯´æ˜

<Callout emoji="ğŸ”">
  è¿™ä¸ªè„šæœ¬çš„ä¸»è¦åŠŸèƒ½ï¼š 1. **è·¨å¹³å°æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ« Windows å’Œ Unix-like ç³»ç»Ÿ 2. **SDKMAN é›†æˆ**:
  è‡ªåŠ¨åŠ è½½ SDKMAN å¹¶åˆ‡æ¢åˆ°é¡¹ç›®æŒ‡å®šçš„ Java ç‰ˆæœ¬ 3. **é”™è¯¯å¤„ç†**: å½“ SDKMAN ä¸å¯ç”¨æ—¶ï¼Œæ˜¾ç¤ºå½“å‰ Java
  ç‰ˆæœ¬ä¿¡æ¯ 4. **å…¶ä»–é’©å­**: æ‰§è¡Œé¢å¤–çš„ Git hooks å’Œä»£ç æ£€æŸ¥
</Callout>

## âœ… éªŒè¯é…ç½®

### æµ‹è¯• Git Commit

é…ç½®å®Œæˆåï¼Œå°è¯•è¿›è¡Œä¸€æ¬¡æäº¤æ¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

```bash
git add .
git commit -m "test: éªŒè¯ SDKMAN é…ç½®"
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼š

```bash
SDKMAN detected, activating project Java version
Using java version 8.0.452-amzn in this shell.
```

### å¸¸è§é—®é¢˜æ’æŸ¥

<ErrorDisplay
  title="SDKMAN æœªæ£€æµ‹åˆ°"
  error="SDKMAN not detected or .sdkmanrc not found"
  code="0"
  path="Project directory"
  details={['SDKMAN æœªæ­£ç¡®å®‰è£…', '.sdkmanrc æ–‡ä»¶ä¸å­˜åœ¨', 'éœ€è¦å…ˆå®‰è£… SDKMAN']}
/>

**è§£å†³æ–¹æ¡ˆ**: å‚è€ƒ [SDKMAN å®‰è£…ä¸é…ç½®æŒ‡å—](/blog/install-sdkman)

<ErrorDisplay
  title="Java ç‰ˆæœ¬ä»ç„¶ä¸åŒ¹é…"
  error="Java version mismatch in Git hooks"
  code="1"
  path="Git hooks execution"
  details={['SDKMAN æœªæ­£ç¡®åŠ è½½', 'ç¯å¢ƒå˜é‡é…ç½®é—®é¢˜', 'éœ€è¦æ£€æŸ¥ shell é…ç½®']}
/>

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿åœ¨ shell é…ç½®æ–‡ä»¶ä¸­æ­£ç¡®åŠ è½½äº† SDKMAN

## ğŸ”— å…³è”å†…å®¹

### ç›¸å…³åšå®¢æ–‡ç« 

- [SDKMAN å®‰è£…ä¸é…ç½®æŒ‡å—](/blog/install-sdkman) - è¯¦ç»†çš„ SDKMAN å®‰è£…å’Œé…ç½®æ­¥éª¤
- [Git Hooks ä¸ Node ç¯å¢ƒé—®é¢˜](/blog/git-hooks-and-node-env) - è§£å†³ Git Hooks ä¸­çš„ Node.js ç¯å¢ƒé—®é¢˜
- [å¤šç¯å¢ƒ Git é…ç½®ç®¡ç†](/blog/multi-environmental-gitconfig) - ç®¡ç†å¤šä¸ªç¯å¢ƒçš„ Git é…ç½®

### ç›¸å…³å·¥å…·

- [Husky](https://typicode.github.io/husky/) - Git hooks å·¥å…·
- [Lint-staged](https://github.com/okonet/lint-staged) - å¯¹æš‚å­˜æ–‡ä»¶è¿è¡Œ linter
- [Maven Spotless](https://github.com/diffplug/spotless) - ä»£ç æ ¼å¼åŒ–æ’ä»¶

---

<Callout emoji="ğŸ‰">
  æ­å–œï¼ç°åœ¨ä½ å·²ç»æˆåŠŸé…ç½®äº† SDKMAN æ¥è§£å†³ Git Hooks ä¸­çš„å¤š JDK ç¯å¢ƒé—®é¢˜ã€‚è¿™å°†ç¡®ä¿ä½ çš„å›¢é˜Ÿä½¿ç”¨ç»Ÿä¸€çš„
  Java ç¯å¢ƒï¼Œé¿å…ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚
</Callout>
